name: "[X] Build Triton (v3.4.0)"

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Build Triton wheels
        uses: ./.github/actions/build-triton
        with:
          python_version: ${{ matrix.python_version }}
          ref: v3.4.0
          AWS_ENDPOINT: ${{ secrets.AWS_ENDPOINT }}
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}

    strategy:
      matrix:
        python_version:
          - "39"
          - "310"
          - "311"
          - "312"
          - "313"

  publish:
    needs: build
    runs-on: ubuntu-latest

    permissions:
      contents: write

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Publish wheels
        uses: ./.github/actions/publish-wheels
        with:
          prefix: triton_pascal-3.4.0-
          pypi_repository_url: ${{ secrets.PYPI_REPOSITORY_URL }}
          pypi_username: ${{ secrets.PYPI_USERNAME }}
          pypi_password: ${{ secrets.PYPI_PASSWORD }}

  # update-index:
  #   needs: publish
  #   secrets: inherit
  #   uses: ./.github/workflows/zz-update-index.yml

  #   permissions:
  #     id-token: write
  #     pages: write

on:
  workflow_dispatch:
